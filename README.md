# 智能体系统架构说明

## 🎯 系统概述

这是一个具有**分层规划**和**低层执行**能力的智能体系统，能够将复杂目标分解为可执行的任务序列，并逐步完成。

## 🏗️ 系统架构

```
用户输入目标
    ↓
┌──────────────────┐
│   智能体入口     │ ← run_agent()
│  (初始化&编排)   │
└──────────────────┘
    ↓
┌──────────────────┐
│   规划阶段       │ ← HierarchicalPlanner
│  (目标→任务列表) │    - 高层规划
└──────────────────┘    - 任务分解
    ↓
┌──────────────────┐
│   执行阶段       │ ← ActionExecutor
│  (逐个执行任务)  │    - 具体执行
└──────────────────┘    - 结果收集
    ↓
┌──────────────────┐
│   决策阶段       │ ← should_continue()
│  (继续或结束?)   │    - 流程控制
└──────────────────┘
    ↓
   结果输出
```

## 🔧 核心组件

### 1. 状态管理 (AgentState)
```python
class AgentState(TypedDict):
    objective: str          # 用户原始目标
    plan: list[str]        # 任务计划列表
    current_step: int      # 当前执行步骤
    messages: list[]       # 对话历史
    results: list[str]     # 执行结果
```

### 2. 分层规划器 (HierarchicalPlanner)
- **职责**: 高层规划 (High-level Planning)
- **输入**: 用户目标描述
- **输出**: 结构化任务列表
- **特点**: 低温度(0)确保输出稳定

### 3. 动作执行器 (ActionExecutor)
- **职责**: 低层执行 (Low-level Action)  
- **输入**: 具体任务描述
- **输出**: 执行结果和观察
- **特点**: 中等温度(0.5)保持创造性

### 4. 工作流引擎 (LangGraph)
- **职责**: 状态管理和流程控制
- **特点**: 支持循环执行和条件分支
- **流程**: planning → execute → decision → execute...

## 🔄 执行流程

1. **初始化**: 设置目标，创建空白状态
2. **规划阶段**: AI分析目标，生成任务列表
3. **执行循环**: 
   - 执行当前任务
   - 收集执行结果  
   - 更新状态信息
   - 判断是否继续
4. **结果汇总**: 返回所有任务的执行结果

## 🎯 关键特性

### 分层处理
- **高层**: 战略规划，目标分解
- **低层**: 具体执行，结果反馈

### 状态持久化  
- 完整的执行历史
- 上下文连贯性
- 错误恢复能力

### 灵活扩展
- 可替换不同的LLM模型
- 可自定义规划和执行策略
- 支持复杂的条件分支

## 🚀 使用方法

```python
# 1. 设置环境变量
export DASHSCOPE_API_KEY="your-api-key"

# 2. 运行智能体
from agents import run_agent
results = run_agent("你的目标描述")

# 3. 查看结果
for i, result in enumerate(results):
    print(f"任务{i+1}: {result}")
```

## 💡 适用场景

- 项目规划和执行
- 学习计划制定
- 工作流程自动化
- 复杂任务分解
- 多步骤问题解决

## 🔧 技术栈

- **LangChain**: LLM调用和提示管理
- **LangGraph**: 工作流状态管理
- **通义千问**: 底层大语言模型
- **Python**: 系统实现语言
